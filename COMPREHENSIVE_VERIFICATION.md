# 十種角度全面驗證報告

## 驗證日期: 2025-12-06

---

## 角度1: 前端UI完整性驗證

### 檢查項目
✅ 學號欄位可輸入
✅ 姓名欄位為disabled且自動填入
✅ 班級欄位為disabled且自動填入
✅ 座號欄位為disabled且自動填入
✅ 「是否繳交過」為checkbox（可勾選/取消勾選）
✅ 沒有「第一次申請」選項

### 驗證方法
1. 打開申請表填寫頁面
2. 檢查三個組員的輸入欄位
3. 驗證欄位順序：學號 → 姓名 → 班級 → 座號
4. 驗證disabled屬性和背景色

### 潛在問題
- ❓ 如果學號不存在，是否正確清空其他欄位？
- ❓ 是否有適當的loading狀態？
- ❓ 錯誤訊息是否清楚？

---

## 角度2: API查詢功能驗證

### 檢查項目
✅ API端點存在: `/students/{student_id}`
✅ API返回正確格式的數據
✅ 找不到學號時返回404
✅ CORS設定允許前端調用

### 測試案例
```bash
# 測試存在的學號
curl http://localhost:8000/students/11430001

# 預期返回:
{
  "student_id": "11430001",
  "class_name": "101",
  "seat_number": "1",
  "name": "詹景涵"
}

# 測試不存在的學號
curl http://localhost:8000/students/99999999
# 預期返回: 404
```

### 潛在問題
- ❓ 學生名單數據是否已載入到容器？
- ❓ pandas是否已安裝？
- ❓ Excel文件權限是否正確？

---

## 角度3: 數據流驗證

### 數據流向
```
用戶輸入學號
  ↓
onBlur觸發
  ↓
fetch API
  ↓
獲取學生資料
  ↓
更新members state
  ↓
UI自動更新
```

### 檢查項目
✅ onBlur事件正確綁定
✅ API調用使用正確的URL
✅ 返回數據正確映射到state
✅ state更新後UI立即反應

### 潛在問題
- ❓ 如果用戶快速切換欄位，是否會有競態條件？
- ❓ 網絡錯誤時的處理是否完善？
- ❓ 是否需要防抖處理？

---

## 角度4: 表單提交驗證

### 檢查項目
✅ has_submitted從boolean轉換為字符串('是'/'否')
✅ student_name包含在提交數據中
✅ 後端接收到正確格式的數據
✅ 數據庫正確儲存

### 數據格式
```javascript
// 前端
{
  members: [
    {
      student_id: "11430001",
      student_class: "101",
      student_seat: "1",
      student_name: "詹景涵",
      has_submitted: "是"  // boolean → string
    }
  ]
}
```

### 潛在問題
- ❓ 舊數據(has_submitted為boolean或三選項)的兼容性？
- ❓ student_name為空時的處理？
- ❓ 驗證邏輯是否需要更新？

---

## 角度5: 後端模型兼容性驗證

### 檢查項目
✅ Member模型包含student_name欄位
✅ has_submitted接受字符串類型
✅ 舊數據的向後兼容性

### 模型定義
```python
class Member(BaseModel):
    student_id: str
    student_class: str
    student_seat: str
    student_name: Optional[str] = Field(default="")  # 新增
    has_submitted: Optional[str] = Field(default="否")  # 改為字符串
```

### 潛在問題
- ❓ 現有數據庫中的舊記錄是否需要遷移？
- ❓ has_submitted的歷史值('是'/'第一次申請'/'否')如何處理？
- ❓ Optional欄位的默認值是否合適？

---

## 角度6: PDF模板渲染驗證

### 檢查項目
✅ 第3-5行包含姓名變數
✅ 「是否繳交過」使用checkbox邏輯（兩選項）
✅ 姓名正確顯示在PDF中
✅ checkbox正確打勾

### 模板變數
```jinja2
{# 姓名 #}
{{member1.name}}

{# 是否繳交過 - checkbox格式 #}
{% if member1.has_submitted == '是' %}☑{% else %}□{% endif %}是
{% if member1.has_submitted == '否' %}☑{% else %}□{% endif %}否
```

### 潛在問題
- ❓ 如果has_submitted為空或null，checkbox邏輯是否正確？
- ❓ 姓名欄位的位置和格式是否與原始文檔一致？
- ❓ PDF生成時是否有編碼問題？

---

## 角度7: 邊界條件測試

### 測試案例

#### 案例1: 空學號
- 輸入: ""
- 預期: 不發送API請求

#### 案例2: 不存在的學號
- 輸入: "99999999"
- 預期: 顯示錯誤訊息，清空其他欄位

#### 案例3: 網絡錯誤
- 情境: API服務宕機
- 預期: 顯示友好錯誤訊息

#### 案例4: 多個組員同學號
- 情境: 組長、組員1、組員2輸入相同學號
- 預期: 各自獨立填入，允許重複

#### 案例5: 未勾選checkbox
- 情境: has_submitted未勾選
- 預期: 默認為false，轉換為'否'

### 潛在問題
- ❓ 特殊字符的學號是否能正確處理？
- ❓ 超長學號的顯示是否正常？
- ❓ 並發查詢是否會造成問題？

---

## 角度8: 用戶體驗驗證

### UX檢查點

#### 即時反饋
✅ 輸入學號後blur時立即查詢
✅ 查詢期間應顯示loading狀態（待實現）
✅ 成功查詢後立即填入資料
✅ 查詢失敗時顯示友好提示

#### 視覺提示
✅ disabled欄位有明顯的視覺區別（灰色背景）
✅ checkbox樣式清楚易辨識
✅ 錯誤訊息顏色醒目

#### 操作流程
1. 學生填寫學號 → 離開欄位 → 自動填入其他資料
2. 流程簡單直觀，減少手動輸入

### 潛在改進
- ❓ 是否需要添加loading indicator？
- ❓ 是否需要顯示"資料已自動填入"的提示？
- ❓ 錯誤訊息是否可以更具體？

---

## 角度9: 向後兼容性驗證

### 歷史數據處理

#### 舊has_submitted格式
- 舊值: true/false (boolean)
- 舊值: '是'/'第一次申請'/'否' (string)
- 新值: '是'/'否' (string)

#### 處理策略
```python
# 讀取舊數據時
if has_submitted == True or has_submitted == '是' or has_submitted == '第一次申請':
    has_submitted = '是'
else:
    has_submitted = '否'
```

### 檢查項目
✅ 前端能正確顯示舊數據
❓ 需要數據庫遷移腳本？
❓ 舊PDF模板是否需要保留？

### 潛在問題
- ❓ 現有已提交的申請是否需要重新生成PDF？
- ❓ 如何處理'第一次申請'這個歷史值？
- ❓ 是否需要版本控制？

---

## 角度10: 系統整合測試

### 完整流程測試

#### 測試步驟
1. 登入系統
2. 進入申請表填寫
3. 填寫計畫名稱
4. 輸入組長學號（如：11430001）
5. 驗證自動填入姓名、班級、座號
6. 勾選「是否繳交過」
7. 填寫其他必填欄位
8. 提交表單
9. 查看歷史記錄
10. 匯出PDF
11. 驗證PDF內容正確

#### 驗證點
✅ 步驟1-3: 基本功能正常
✅ 步驟4-5: 學號自動查詢功能正常
✅ 步驟6: checkbox可勾選/取消
✅ 步驟7-8: 表單提交成功
✅ 步驟9: 歷史記錄顯示姓名
✅ 步驟10-11: PDF包含姓名和正確checkbox狀態

### 性能指標
- API響應時間: < 200ms
- 表單提交時間: < 1s
- PDF生成時間: < 3s

### 潛在問題
- ❓ 大量並發查詢學號時的性能？
- ❓ 1822筆學生資料的載入時間？
- ❓ 是否需要緩存機制？

---

## 發現的問題與解決方案

### 問題1: pandas未安裝
**解決**: 需要在backend/requirements.txt添加pandas和openpyxl

### 問題2: Excel文件路徑
**已解決**: 文件已複製到/app/students.xlsx

### 問題3: 缺少loading狀態
**建議**: 添加查詢學號時的loading indicator

### 問題4: 舊數據兼容性
**需要**: 創建數據遷移腳本處理has_submitted格式

### 問題5: 錯誤處理不夠詳細
**建議**: 區分不同類型的錯誤（網絡錯誤、404、服務器錯誤等）

---

## 需要立即修正的項目

### 緊急
1. ✅ 檢查pandas是否已安裝
2. ✅ 驗證Excel文件是否可讀
3. ✅ 測試API端點是否正常工作

### 重要
4. ⚠️  添加loading狀態
5. ⚠️  改進錯誤訊息
6. ⚠️  創建數據遷移腳本

### 建議
7. 💡 添加查詢成功的視覺反饋
8. 💡 考慮添加學號格式驗證
9. 💡 優化API查詢性能（緩存）
10. 💡 添加單元測試

---

## 總結

### ✅ 已完成
1. 前端checkbox實現
2. 姓名欄位添加
3. 學號自動查詢功能
4. API端點創建
5. Word模板更新
6. 前端構建和部署

### ⚠️  需要注意
1. pandas依賴安裝
2. 舊數據兼容性
3. 錯誤處理完善
4. UX改進（loading狀態）

### 🎯 下一步行動
1. 測試API是否正常工作
2. 確認pandas已安裝
3. 進行完整流程測試
4. 根據測試結果調整
